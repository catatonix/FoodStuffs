<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-input/paper-textarea.html"><link rel="import" href="../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-time-input/paper-time-input.html"><link rel="import" href="../bower_components/paper-styles/color.html"><link rel="import" href="../bower_components/paper-alert-dialog/paper-alert-dialog.html"><link rel="import" href="../bower_components/titanium-date-input/titanium-date-input.html"><link rel="import" href="../bower_components/polymerfire/firebase-query.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="my-add-meal"><template><style include="shared-styles">:host{display:block;padding:10px;}paper-time-input{display:inline-block;}#meal-content p{display:inline-block;width:90%;}#meal-content paper-icon-button{display:inline-block;}paper-button.green{background-color:var(--paper-green-500);color:white;}#add-meal{left:50%;transform:translateX(-50%);padding:5px 100px;}#mealTime, #mealDate{vertical-align:bottom;margin-left:2em;display:inline-block;}#timeIcon{margin-bottom:10px;}</style><firebase-auth id="auth" user="{{user}}" provider="google" on-error="handleError"></firebase-auth><firebase-query id="contentQuery" path="/users/[[user.uid]]/meals/draft/content" data="{{mealContents}}"></firebase-query><firebase-query id="mealsQuery" path="/users/[[user.uid]]/meals" data="{{meals}}"></firebase-query><div class="card"><h1>Add Meal</h1><paper-input label="Meal Name" id="mealLabel" required="" auto-validate="" value="{{mealLabel}}"><iron-icon src="/images/icons/meal.svg" slot="prefix"></iron-icon></paper-input><div class="start-time"><iron-icon id="timeIcon" src="/images/icons/time.svg" slot="prefix"></iron-icon><paper-time-input id="mealTime" hour="{{hours}}" min="{{mins}}" am-pm="{{amPm}}" label="Start Time" required="" auto-validate=""></paper-time-input><titanium-date-input label="Day" auto-validate="" required="" id="mealDate" error-message="Please use a valid date of birth" date-pattern="dd/mm/yyyy" placeholder="{{date}}" value="[[date]]"></titanium-date-input></div></div><div class="card"><paper-input label="Meal Item" id="newContent" required=""><paper-button slot="suffix" on-tap="addContent">Add</paper-button></paper-input><template is="dom-repeat" items="[[mealContents]]" as="mealContent"><ul id="meal-content"><li><p>[[mealContent.$val]]</p><paper-icon-button src="/images/icons/trash.svg" note="[[mealContent]]" on-tap="remove"></paper-icon-button></li></ul></template></div><div class="card"><paper-textarea label="Notes" id="mealNotes"></paper-textarea></div><div class="card"><paper-button raised="" class="green" on-tap="addMeal">Add Meal</paper-button><paper-button raised="" class="" on-tap="confirmClear">Clear Meal</paper-button></div><paper-alert-dialog id="missingContent" title="No Content!!" confirm-button="OK" on-confirm="confirm">Sorry! We don't yet support adding empty meals...<br>Please add some content.</paper-alert-dialog><paper-alert-dialog id="confirmClear" title="are you sure?" dismiss-button="Cancel" confirm-button="Clear" on-confirm="_resetInputs">Do you really want to clear this meal?</paper-alert-dialog></template><script>class MyAddMeal extends Polymer.Element{static get is(){return"my-add-meal"}static get Properties(){return{mealContents:{type:Object}}}addContent(){console.log("> addContent() called...");var a=this.$.newContent.value;a?(this.$.contentQuery.ref.push(a),this.$.newContent.value=null,console.log(a),console.log("> ... and ^ was added by addContent().")):(this.$.newContent.validate(),console.log("> ... but no content was added by addContent()."))}addMeal(){console.log("> addMeal() called...");var a=this.$.mealLabel.value,b=this.$.mealDate.value+"-"+this.$.mealTime.value,c={},d=this.$.mealNotes.value;if(this.mealContents.forEach(function(a){c[a.$key]=a.$val},this),this._validate(a,b,c)){var e={label:a,datetime:b,content:c,notes:d};this.$.mealsQuery.ref.push(e),this._resetInputs(),console.log(e),console.log("> ... and ^ was added by addMeal().")}else console.log("> ... but no content was added by addMeal()."),this.$.missingContent.open()}remove(a){var b=a.currentTarget.note.$key;this.$.contentQuery.ref.child(b).remove()}confirmClear(){this.$.confirmClear.open()}_validate(a,b,c){var d=0!==Object.keys(c).length||c.constructor!==Object;return a&&b&&d}_resetInputs(){console.log("> _resetInputs() called..."),console.log(this.$.contentQuery);try{this.$.contentQuery.ref.remove(),console.log("... ^ cleared by resetInputs().")}catch(a){console.log("... failed to clear ^ by resetInputs().")}this.mealLabel=this._suggestMealLabel(),this.date=this._todayDate(),this.$.mealNotes.value="";var a=this._todayTime();this.mins=a.mins,this.hours=a.hours,this.amPm=a.amPm}_suggestMealLabel(){return"Lunch"}_todayDate(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return a=b+"/"+c+"/"+d,a}_todayTime(){var a=new Date,b=a.getMinutes(),c=a.getHours(),d="AM";return 12<c&&(d="PM",c-=12),a={mins:b,hours:c,amPm:d},a}_parseTime(a){var b=a.split("-"),c=b[0];b=b[1].split(":");var d=b[0];b=b[1].split(" ");var e=b[0],f=b[1];return{date:c,hours:d,mins:e,amPm:f}}_renderMeal(a){this.mealLabel=a.mealLabel;var b=this._parseTime(a.datetime);this.hours=b.hours,this.mins=b.mins,this.amPm=b.amPm,this.date=b.date,this.mealContent=b.mealContent}ready(){super.ready(),this._resetInputs(),this._parseTime("13/11/2017-2:21 AM")}}var contents=this.mealContents;customElements.define(MyAddMeal.is,MyAddMeal);</script></dom-module></body></html>